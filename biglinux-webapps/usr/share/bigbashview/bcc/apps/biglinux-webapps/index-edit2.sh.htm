#!/usr/bin/env bash

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=biglinux-webapps

#DESKNAME="$(grep "Name=" $filedesk | sed 's|Name=||')"
#DESKICON="$(grep "Icon=" $filedesk | sed 's|Icon=||')"
#if [ "$DESKICON" = "webapp" ];then
#   DESKICON="img/default.png"
#fi
#if [ "$(grep "Exec=" $filedesk | grep 'firefox')" ];then
#   DESKEXEC="$(grep "Exec=" $filedesk | sed 's|Exec=||')"
#   DESKURL="$(grep "\-new-instance" $DESKEXEC | cut -d' ' -f9 | sed 's|^"||;s|"$||')"
#else
#   DESKEXEC="$(grep "Exec=" $filedesk | sed 's|Exec=||')"
#   DESKURL="$(grep Exec= $filedesk | sed 's|.*app=||')"
#fi

echo -n "$filedesk<br><br>$DESKNAME<br>$DESKICON<br>$DESKEXEC<br>$DESKURL"
exit

[ -e "$(xdg-user-dir DESKTOP)/$DESKNAME.desktop" ] && checked="checked"
[ "$(grep embed <<< $DESKURL)" ] && checked_you="checked"
[ "$(grep user-data-dir <<< $DESKEXEC)" ] && checked_new="checked"

echo '
<!-- Cabeçalho -->
<head>

    <!-- Carregando o tema css do app -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min_litera.css">
    <link rel="stylesheet" type="text/css" href="css/tooltip.css">

    <!-- Carregando jquery e o js necessário -->
    <script type="application/javascript" src="js/jquery-3.6.0.min.js"></script>
    <script type="application/javascript" src="js/bootstrap.bundle.min.js"></script>
    <script type="application/javascript" src="js/app.js"></script>
</head>

<!-- Corpo da página -->
<body id="app">
    <div class="container-fluid">
        <p class="text-center h3">
            '$"Editar WebApps BigLinux"'
        </p>

        <!-- Formulário de edição do webapp -->
        <form action="webapp-install2.sh" method="get" id="form-edit">
            <input type="hidden" value="'$filedesk'" name="filedesk">
            <div class="row justify-content-center">
                <div class="col-8">
                    <label for="namedesk">'$"NOME:"'</label>
                    <input type="text" class="form-control form-control-sm"
                       name="namedesk" id="namedesk" value="'$DESKNAME'" required/>
                </div>
                <div class="mb-2 col-8">
                    <label for="urldesk" class="mt-2">'$"URL:"'</label>
                    <input type="text" class="form-control form-control-sm" readonly="readonly"
                       name="urldesk" id="urldesk" value="'$DESKURL'" required/>
                </div>
            </div>

            <div class="row justify-content-center">
                <div class="col-4">
                   <button data-bs-toggle="tooltip" data-bs-placement="top"
                       title="'$"Detecta automaticamente o título do site e sugere como nome do webapp"'"
                       class="btn btn-sm btn-primary btn-small-lg" id="gettitle">
                        <span id="btn-title">
                            <i class="bi bi-window"></i>
                            '$"Detectar Título"'
                        </span>
                        <span id="btn-title-go">
                            <i class="bi bi-window"></i>
                            '$"Detectando"'
                            <span class="spinner-border spinner-border-sm"
                                  role="status" aria-hidden="true"></span>
                        </span>
                   </button>
                </div>
                <div class="col-3">
                  <button data-bs-toggle="tooltip" data-bs-placement="top" data-html="true"
                     title="'$"Detecta automaticamente o ícone do site, mas não são todos os sites que suportam o recurso.<br>Por exemplo, sites que necessitam de login"'"
                     class="btn btn-sm btn-primary btn-small-lg" id="favicon">
                     <span id="btn-icon">
                        <i class="bi bi-image-fill"></i>
                        '$"Detectar Ícone"'
                     </span>
                     <span id="btn-icon-go">
                        <i class="bi bi-image-fill"></i>
                        '$"Detectando"'
                        <span class="spinner-border spinner-border-sm"
                              role="status" aria-hidden="true"></span>
                     </span>
                   </button>
                </div>
            </div>

            <div class="row">
                <div class="col-2"></div>
                <div class="mt-2 col-1">
                    <label for="icondesk" class="mb-1">'$"ÍCONE:"'</label><br>
                    <img id="preview" src="'$DESKICON'" width="48" height="48"/>
                </div>
                <div class="mt-5 col-5">
                    <input type="text" id="icondesk" value="'$(basename $DESKICON)'"
                           class="form-control form-control-sm align-content-start" readonly/>
                    <input type="hidden" name="icondesk" id="icondeskhidden" value="'$DESKICON'">
                </div>
                <div class="mt-5 col-1">
                    <a data-bs-toggle="tooltip" data-bs-placement="top"
                       title="'$"Carrega um arquivo de imagem para ser usado como ícone."'"
                       class="btn btn-sm btn-primary btn-small" id="btn">
                       <i class="bi bi-folder2-open"></i>
                       '$"Abrir"'
                    </a>
                </div>
            </div>

            <div class="row">
                <div class="col-2"></div>
                <div class="mt-2 col-1">
                    <label class="mb-1">'$"NAVEGADOR:"'</label>
                    <img src="" id="browsericon" width="48" height="48">
                </div>
                <div class="col-4">
                        <select name="browser" class="mt-5 form-select form-select-size">'


                if [ -e /usr/lib/brave/brave ];then
                    if [ "$(grep brave $filedesk)" ];then
                        echo '<option value="brave" class="form-option" selected>BRAVE</option>'
                    else
                        echo '<option value="brave" class="form-option">BRAVE</option>'
                    fi
                fi

                if [ -e /usr/lib/firefox/firefox ];then
                    if [ "$(grep firefox $filedesk)" ];then
                        echo '<option value="firefox" class="form-option" selected>FIREFOX</option>'
                    else
                        echo '<option value="firefox" class="form-option">FIREFOX</option>'
                    fi
                fi

                if [ -e /usr/lib/firefox-developer-edition/firefox ];then
                    if [ "$(grep firefox-developer-edition $filedesk)" ];then
                        echo '<option selected value="firefox-developer-edition" class="form-option">FIREFOX DEVELOPER</option>'
                    else
                        echo '<option value="firefox-developer-edition" class="form-option">FIREFOX DEVELOPER</option>'
                    fi
                fi

                if [ -e /opt/firefox-nightly/firefox ];then
                    if [ "$(grep firefox-nightly $filedesk)" ];then
                        echo '<option selected value="firefox-nightly" class="form-option">FIREFOX NIGHTLY</option>'
                    else
                        echo '<option value="firefox-nightly" class="form-option">FIREFOX NIGHTLY</option>'
                    fi
                fi

                if [ -e /opt/google/chrome/google-chrome ];then
                    if [ "$(grep google-chrome-stable $filedesk)" ];then
                        echo '<option selected value="google-chrome-stable" class="form-option">CHROME</option>'
                    else
                        echo '<option value="google-chrome-stable" class="form-option">CHROME</option>'
                    fi
                fi

                if [ -e /opt/google/chrome-beta/google-chrome-beta ];then
                    if [ "$(grep google-chrome-beta $filedesk)" ];then
                        echo '<option selected value="google-chrome-beta" class="form-option">CHROME BETA</option>'
                    else
                        echo '<option value="google-chrome-beta" class="form-option">CHROME BETA</option>'
                    fi
                fi

                if [ -e /opt/google/chrome-unstable/google-chrome-unstable ];then
                    if [ "$(grep google-chrome-unstable $filedesk)" ];then
                        echo '<option selected value="google-chrome-unstable" class="form-option">CHROME UNSTABLE</option>'
                    else
                        echo '<option value="google-chrome-unstable" class="form-option">CHROME UNSTABLE</option>'
                    fi
                fi

                if [ -e /usr/lib/chromium/chromium ];then
                    if [ "$(grep chromium $filedesk)" ];then
                        echo '<option selected value="chromium" class="form-option">CHROMIUM</option>'
                    else
                        echo '<option value="chromium" class="form-option">CHROMIUM</option>'
                    fi
                fi

                if [ -e /opt/vivaldi/vivaldi ];then
                    if [ "$(grep vivaldi-stable $filedesk)" ];then
                        echo '<option selected value="vivaldi-stable" class="form-option">VIVALDI</option>'
                    else
                        echo '<option value="vivaldi-stable" class="form-option">VIVALDI</option>'
                    fi
                fi

                echo   '</select>
                </div>
                <div class="mt-5 col-3 form-check form-switch" id="perfil">
                    <label class="form-check-label" data-bs-toggle="tooltip" data-bs-placement="top" for="newperfil"
                           title="'$"Essa opção permite que você crie webapps que não compartilham informações.<br>Por exemplo, para logar em contas de e-mails diferentes, assim cada webapp manterá o login separadamente."'" data-html="true">
                           <i class="bi bi-person-plus-fill"></i>
                           '$"Novo Perfil"'</label>
                     <input class="form-check-input" type="checkbox" name="newperfil" id="newperfil" '$checked_new'/>
                </div>
            </div>

           <div class="row justify-content-start">
                <div class="col-2">&nbsp;</div>
                <div class="mt-3 col-4 form-check form-switch" style="margin-left:15px;">
                    <label class="form-check-label" for="desktop" data-bs-toggle="tooltip"
                           data-bs-placement="top" title="'$"Adiciona um atalho na área de trabalho"'">
                      <i class="bi bi-link-45deg"></i>
                      '$"Adicionar atalho"'
                    </label>'
            echo '
                    <input class="form-check-input" id="desktop"
                           type="checkbox" name="shortcut" '$checked'/>
                </div>
            </div>

            <div class="row justify-content-start">
                <div class="col-2">&nbsp;</div>
                <div class="mt-2 col-4 form-check form-switch" id="modetv" style="margin-left:15px">
                    <label class="form-check-label" data-bs-toggle="tooltip" data-bs-placement="top" for="tvmode"
                       title="'$"Essa opção permite que você visualize os vídeos do YouTube sem outras informações.<br>Por exemplo, sem propagandas e sem outros vídeos."'" data-html="true">
                       <i class="bi bi-tv"></i>
                       '$"YouTube em Modo TV"'
                    </label>
                    <input class="form-check-input" type="checkbox" name="tvmode" id="tvmode" '$checked_you' />
                </div>
                <div class="col-4" id="modetv_empty" style="margin-left:15px;">&nbsp;</div>
                <div class="col-5">
                    <a href="index.sh.htm" class="btn btn-sm btn-dark btn-small-home"
                       data-bs-toggle="tooltip" data-bs-placement="top"
                       title="'$"Tela Inicial"'">
                       <i class="bi home bi-house-fill"></i>
                    </a>
                    <a href="index-edit.sh.htm" class="btn btn-sm btn-dark btn-small">
                        <i class="bi bi-arrow-left"></i>
                        '$"Voltar"'
                    </a>
                    <button type="submit" class="btn btn-sm btn-primary btn-small" id="install-edit">
                            <i class="bi bi-check2-circle"></i>
                            '$"Concluir"'
                    </button>
                </div>
            </div>
        </form>
    </div>

<div class="alert alert-warning alert-fixed" id="alert-name">
  <div class="text-center">
    <i class="bi bi-exclamation-octagon"></i>
    <strong>'$"ATENÇÃO:"'</strong>
      '$"Insira um nome para continuar"'
  </div>
</div>

<div class="alert alert-danger alert-fixed" id="alert-favicon">
  <div class="text-center">
    <i class="bi bi-x-octagon"></i>
    <strong>'$"Erro:"'</strong>
      '$"Não foi possível detectar o ícone!"'<br>'$"Verifique e tente novamente"'
  </div>
</div>

<div class="alert alert-danger alert-fixed" id="alert-title">
  <div class="text-center">
    <i class="bi bi-x-octagon"></i>
    <strong>'$"Erro:"'</strong>
      '$"Não foi possível detectar o título!"'<br>'$"Verifique e tente novamente"'
  </div>
</div>

<div class="alert alert-success alert-fixed" id="alert-edit">
  <div class="text-center">
    <strong>'$"O WebApp foi editado com sucesso!"'</strong>
    <i class="bi bi-hand-thumbs-up-fill"></i>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="modal-favicon"
     aria-labelledby="modalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg" role="document">
    <div class="modal-content justify-content-center">
      <div class="modal-header text-center">
        <b class="modal-title" id="modalLabel" style="padding-left:16%">
          '$"Encontramos mais de um ícone no site!"'</b>
        <button type="button" class="btn-close"
                data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true"></span>
        </button>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
          <h6 class="text-center mb-3">'$"Escolha um deles e clique para selecionar:"'</h6>
          <div class="row justify-content-center" id="modal-body"></div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>'
