#!/usr/bin/env bash

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=biglinux-webapps

echo '
<head>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min_litera.css">
    <link rel="stylesheet" type="text/css" href="css/tooltip.css">

    <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="js/app.js"></script>

</head>
<body id="app">

    <div class="container-fluid">'

DESKTOP="$(ls $HOME/.local/share/applications/*webapp-biglinux-custom.desktop)"

if [ "$DESKTOP" ];then

echo '<div class="row">
        <div class="col-1"></div>

        <div class="col-1">
          <a href="index.sh.htm" class="btn btn-sm btn-dark btn-small-home mt-2"
             data-bs-toggle="tooltip" data-bs-placement="top"
             title="'$"Tela Inicial"'">
            <i class="bi home bi-house-fill"></i>
          </a>
        </div>

        <div class="col-7">
          <p class="text-center h3">
            '$"Editar WebApps BigLinux"'
          </p>
        </div>

         <div class="col-2">
          <div class="input-group input-group-sm">
            <span class="input-group-text mt-3" style="height:33px">
                <i class="bi bi-funnel-fill"></i>
            </span>
            <input type="search" class="form-control form-control-sm mt-3"
                   id="filter-edit" placeholder="'$"Filtro"'">
          </div>
        </div>

      </div>
      <div class="row">
        <div class="col-1"></div>
        <div class="col-10">
          <table class="table table-hover table-striped table-fixed">
            <thead class="table-dark">
                <tr>
                  <th class="text-center col-1" scope="col">'$"ÍCONE"'</th>
                  <th class="text-center col-4" scope="col">'$"NOME"'</th>
                  <th class="text-center col-5" scope="col">'$"URL"'</th>
                  <th class="text-center col-2" scope="col">'$"AÇÃO"'</th>
                </tr>
            </thead>
            <tbody id="table-filter-edit">'

for i in $DESKTOP; do

    DESKEXEC="$(grep "^Exec=" $i | sed 's|Exec=||')"
    DESKNAME="$(grep "^Name=" $i | sed 's|Name=||')"
    DESKCATEG="$(grep "^Categories=" | sed 's|Categories=||;s|\;$||')"
    DESKICON="$(grep "^Icon=" $i | sed 's|Icon=||')"
    [ "$DESKICON" = "webapp" ] && DESKICON="img/default.png"

    [ "$(grep 'firefox' <<< $i)" ] && {
        DESKURL="$(grep '--new-instance' $DESKEXEC | cut -d' ' -f9 | sed 's|^"||;s|"$||')"
    } || {
        DESKURL="$(grep "^Exec=" $i | sed 's|.*app=||')"
    }

echo '<tr class="table-light" style="line-height:40px">
        <form action="index-edit2.sh.htm" method="get">
            <input type="hidden" name="filedesk" value="'$i'"/>
            <input type="hidden" name="DESKNAME" value="'$DESKNAME'"/>
            <input type="hidden" name="DESKICON" value="'$DESKICON'"/>
            <input type="hidden" name="DESKURL" value="'$DESKURL'"/>
            <input type="hidden" name="DESKEXEC" value="'$DESKEXEC'"/>
            <input type="hidden" name="DESKCATEG" value="'$DESKCATEG'"/>
            <td class="col-1">
                <img class="img-thumbnail center" src="'$DESKICON'" width="42" height="42"/>
            </td>
            <td class="text-truncate col-4 text-center"
                data-bs-toggle="tooltip" data-bs-placement="top"
                title="'$DESKNAME'">'$DESKNAME'</td>
            <td class="text-truncate col-5 text-center"
                data-bs-toggle="tooltip" data-bs-placement="top"
                title="'$DESKURL'">'$DESKURL'</td>
            <td class="text-center col-2">
              <button type="submit" class="btn btn-info btn-sm btn-small"
                      data-bs-toggle="tooltip" data-bs-placement="top"
                      title="'$"Editar"'">
                  <i class="bi bi-pencil-square"></i>
              </button>
            </td>
        </form>
    </tr>'

done
echo '      </tbody>
        </table>
      </div>
  </div>
</div>'

else

echo '
    <p class="text-center h3">
        '$"Editar WebApps BigLinux"'
    </p>
    <div class="row justify-content-center">
        <div class="card border-dark bg-secondary mb-3" style="max-width: 42rem;">
          <div class="card-body">
            <h5 class="card-title">'$"Atenção! Nenhum WebApp BigLinux instalado por você!"'</h5>
            <p class="card-text">'$"Se você deseja instalar um novo WebApp BigLinux, clique no botão Instalar"'</p>
          </div>
        </div>
    </div><br>
    <div class="row justify-content-center">
        <div class="col-3">
            <a href="index.sh.htm" class="btn btn-sm btn-dark btn-small-home"
               data-bs-toggle="tooltip" data-bs-placement="top"
               title="'$"Tela Inicial"'">
               <i class="bi home bi-house-fill"></i>
            </a>
            <a href="index-install.sh.htm" class="btn btn-sm btn-primary btn-small">
               <i class="bi bi-check2-circle"></i>
               '$"Instalar"'
            </a>
        </div>
    </div>
</div>'
fi

echo '</body>'
