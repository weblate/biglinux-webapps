#!/usr/bin/env bash

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=biglinux-webapps

echo '
<head>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min_litera.css">
    <link rel="stylesheet" type="text/css" href="css/tooltip.css">

    <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>

</head>
<body id="app">

    <div class="container-fluid">'

DESKTOP="$(ls $HOME/.local/share/applications/*webapp-biglinux-custom.desktop)"

if [ "$DESKTOP" ];then

echo '<div class="row">

        <div class="col-1"></div>

        <div class="col-1">
          <a href="index.sh.htm" class="btn btn-sm btn-dark btn-small-home mt-2"
             data-bs-toggle="tooltip" data-bs-placement="top"
             title="'$"Tela Inicial"'">
            <i class="bi home bi-house-fill"></i>
          </a>
        </div>

        <div class="col-7">
          <p class="text-center h3">
            '$"Remover WebApps BigLinux"'
          </p>
        </div>

        <div class="col-2">
          <div class="input-group input-group-sm">
            <span class="input-group-text mt-3" style="height:33px">
                <i class="bi bi-funnel-fill"></i>
            </span>
            <input type="text" class="form-control form-control-sm mt-3"
                   id="filter" placeholder="'$"Filtrar"'">
          </div>
        </div>

      </div>

      <div class="row">
        <div class="col-1"></div>
        <div class="col-10">
          <table class="table table-hover table-striped table-fixed">
            <thead class="table-dark">
                <tr>
                  <th class="text-center col-1" scope="col">'$"ÍCONE"'</th>
                  <th class="text-center col-4" scope="col">'$"NOME"'</th>
                  <th class="text-center col-5" scope="col">'$"URL"'</th>
                  <th class="text-center col-2" scope="col">'$"AÇÃO"'</th>
                </tr>
            </thead>
            <tbody id="table-filter-del">'

for i in $DESKTOP; do

    if [ "$(grep Exec= $i | grep firefox)" ];then
        DESKEXEC="$(grep Exec= $i | sed 's|Exec=||')"
        DESKURL="$(grep "\-new-instance" $DESKEXEC | cut -d' ' -f9 | sed 's|^"||;s|"$||')"
    else
        DESKURL="$(grep Exec= $i | awk -F'--app=' '{print $NF}')"
    fi

    DESKNAME="$(grep "Name=" $i | sed 's|Name=||')"
    DESKICON="$(grep "Icon=" $i | sed 's|Icon=||')"
    if [ "$DESKICON" = "webapp" ];then DESKICON="img/default.png";fi

echo '<tr class="table-light" style="line-height:38px">
        <form action="webapp-remove.sh" method="get">
            <input type="hidden" name="filedesk" value="'$i'"/>
            <td class="col-1">
                <img class="img-thumbnail center" src="'$DESKICON'" width="42" height="42"/>
            </td>
            <td class="text-truncate align-middle col-4 text-center"
                data-bs-toggle="tooltip" data-bs-placement="top"
                title="'$DESKNAME'">'$DESKNAME'</td>
            <td class="text-truncate align-middle col-5 text-center"
                data-bs-toggle="tooltip" data-bs-placement="top"
                title="'$DESKURL'">'$DESKURL'</td>
            <td class="text-center col-2">
              <button type="submit" class="btn btn-danger btn-sm btn-small"
                      data-bs-toggle="tooltip" data-bs-placement="top"
                      title="'$"Remover"'">
                  <i class="bi bi-trash-fill"></i>
              </button>
            </td>
        </form>
    </tr>'
done
echo '      </tbody>
        </table>
      </div>
  </div>
</div>'

else

echo '
    <p class="text-center h3">
      '$"Remover WebApps BigLinux"'
    </p>
    <div class="row justify-content-center">
        <div class="card border-dark bg-secondary mb-3" style="max-width: 42rem;">
          <div class="card-body">
            <h5 class="card-title">'$"Atenção! Nenhum WebApp BigLinux instalado por você!"'</h5>
            <p class="card-text">'$"Se você deseja instalar um novo WebApp BigLinux, clique no botão Instalar"'</p>
          </div>
        </div>
    </div><br>
    <div class="row justify-content-center">
        <div class="col-3">
            <a href="index.sh.htm" class="btn btn-sm btn-dark btn-small-home"
               data-bs-toggle="tooltip" data-bs-placement="top"
               title="'$"Tela Inicial"'">
               <i class="bi home bi-house-fill"></i>
            </a>
            <a href="index-install.sh.htm" class="btn btn-sm btn-primary btn-small">
               <i class="bi bi-check2-circle"></i>
               '$"Instalar"'
            </a>
        </div>
    </div>
</div>'
fi

echo '
<script type="text/javascript">
    $(document).ready(function(){

        $("#filter").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $("#table-filter-del tr").filter(function() {
              $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });
</script>
</body>'
