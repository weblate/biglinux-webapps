#!/usr/bin/env bash

#Translation
export TEXTDOMAINDIR="/usr/share/locale"
export TEXTDOMAIN=biglinux-webapps

echo '
<head>
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min_litera.css">
    <link rel="stylesheet" type="text/css" href="css/tooltip.css">

    <script type="text/javascript" src="js/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>

</head>
<body id="app">

    <div class="container-fluid">
        <p class="text-center h3">'$"Remover WebApps BigLinux"'</p>'

DESKTOP="$(ls $HOME/.local/share/applications/*webapp-biglinux-custom.desktop)"

if [ $DESKTOP ];then

echo '<div class="row">
        <div class="col-2"></div>
        <div class="col-8">
          <table class="table table-hover table-striped">
            <thead>
                <tr>
                  <th class="text-center" scope="col">'$"ÍCONE"'</th>
                  <th class="text-center" scope="col">'$"NOME"'</th>
                  <th class="text-center" scope="col">'$"URL"'</th>
                  <th class="text-center" scope="col">'$"AÇÃO"'</th>
                </tr>
            </thead>
            <tbody>'

for i in $DESKTOP; do

    if [ "$(grep Exec= $i | grep firefox)" ];then
        DESKEXEC="$(grep Exec= $i | sed 's|Exec=||')"
        DESKURL="$(grep "\-new-instance" $DESKEXEC | cut -d' ' -f9 | sed 's|^"||;s|"$||')"
    else
        DESKURL="$(grep Exec= $i | awk -F'--app=' '{print $NF}')"
    fi

    DESKNAME="$(grep "Name=" $i | sed 's|Name=||')"
    DESKICON="$(grep "Icon=" $i | sed 's|Icon=||')"
    if [ "$DESKICON" = "webapp" ];then DESKICON="img/default.png";fi

echo '<tr class="table-active">
        <form action="webapp-remove.sh" method="get">
            <input type="hidden" name="filedesk" value="'$i'"/>
            <td>
                <img class="center" src="'$DESKICON'" width="42" height="42"/>
            </td>
            <td class="text-truncate align-middle" style="max-width: 10rem;">'$DESKNAME'</td>
            <td class="text-truncate align-middle" style="max-width: 10rem;">'$DESKURL'</td>
            <td>
              <button type="submit" class="btn btn-danger btn-sm btn-small"><i class="bi bi-trash-fill"></i></button>
            </td>
        </form>
    </tr>'

done
echo '      </tbody>
        </table>
      </div>
  </div>
  <div class="row justify-content-center">
    <div class="col-2">
        <a href="index.sh.htm" class="btn btn-sm btn-dark btn-small"
           data-bs-toggle="tooltip" data-bs-placement="top"
           title="'$"Ir para página inicial"'">'$"Voltar"'
        </a>
    </div>
  </div>
</div>'

else

echo '
    <div class="row justify-content-center">
        <div class="card border-dark bg-secondary mb-3" style="max-width: 40rem;">
          <div class="card-header">'$"Atenção!"'</div>
          <div class="card-body">
            <h4 class="card-title">'$"Nenhum WebApp BigLinux instalado por você!"'</h4>
            <p class="card-text">'$"Se você deseja instalar um novo WebApp BigLinux, clique no botão Instalar"'</p>
          </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-2">
            <a href="index.sh.htm" class="btn btn-sm btn-dark btn-small"
               data-bs-toggle="tooltip" data-bs-placement="top"
               title="'$"Ir para página inicial"'">'$"Voltar"'
            </a>
        </div>
        <div class="col-2">
            <a href="index-install.sh.htm" class="btn btn-sm btn-primary btn-small"
               data-bs-toggle="tooltip" data-bs-placement="top"
               title="'$"Ir para página de instalação do WebApp"'">'$"Instalar"'
            </a>
        </div>
    </div>
</div>'
fi

echo '</body>'
